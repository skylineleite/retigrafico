<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Retigráfico - Meus Arquivos</title>
  
  <link rel="manifest" href="manifest.webmanifest?v=2">
  <meta name="theme-color" content="#00693e">

  <style>
    :root{
      --brand:#0ea5e9;
      --bg:#f8fafc;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --radius:16px;
      --danger:#ef4444;
      --whatsapp:#25D366;
    }
    body{
      font-family:system-ui,-apple-system,sans-serif;
      margin:0;
      background:var(--bg);
      color:var(--ink);
      display:flex;
      flex-direction:column;
      min-height:100vh;
      padding:20px;
      overflow-x: hidden;
    }

    /* SPLASH */
    #splash-screen {
      position: fixed;
      inset: 0;
      background-image: url('image_3.png');
      background-size: cover;
      background-position: center top;
      background-repeat: no-repeat;
      z-index: 9999;
      transition: opacity 0.8s ease-out, visibility 0.8s;
    }
    #splash-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

    /* LAYOUT */
    .container{ width:100%; max-width:600px; margin:0 auto; }
    
    .header-home {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }
    .header-home img { width: 50px; height: 50px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .header-home h1 { font-size: 20px; margin: 0; }
    .header-home p { margin: 0; font-size: 13px; color: var(--muted); }

    /* BOTÃO NOVO */
    .btn-new {
      width: 100%;
      background: var(--brand);
      color: white;
      padding: 18px;
      border-radius: var(--radius);
      border: none;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 10px 20px -5px rgba(14,165,233,0.4);
      margin-bottom: 30px;
      transition: transform 0.1s;
    }
    .btn-new:active { transform: scale(0.98); }

    /* LISTA */
    .section-title { font-size: 14px; font-weight: 700; color: var(--muted); text-transform: uppercase; margin-bottom: 12px; letter-spacing: 1px; }
    
    .file-list { display: flex; flex-direction: column; gap: 12px; }
    
    .file-card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.02);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .file-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .file-date { font-size: 11px; color: var(--muted); background: #f1f5f9; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
    .file-name { font-size: 16px; font-weight: 700; color: var(--ink); margin-top: 6px; }
    .file-kms { font-size: 13px; color: var(--muted); margin-top: 2px; }

    .file-actions {
      display: flex;
      gap: 8px;
      border-top: 1px solid #f1f5f9;
      padding-top: 12px;
    }

    .btn-card {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn-open { background: #e0f2fe; color: #0369a1; }
    .btn-share { background: #dcfce7; color: #15803d; }
    .btn-del { background: #fee2e2; color: #b91c1c; flex: 0 0 40px; }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
      font-size: 14px;
      background: #fff;
      border-radius: var(--radius);
      border: 1px dashed #cbd5e1;
    }

    /* WHATSAPP ICON SVG */
    .icon-wa { width: 16px; height: 16px; fill: currentColor; }
  </style>
</head>
<body>

  <div id="splash-screen"></div>

  <div class="container">
    <div class="header-home">
      <img src="image_1.png" alt="Logo">
      <div>
        <h1>Retigráfico</h1>
        <p>Gerenciador de Coletas</p>
      </div>
    </div>

    <button class="btn-new" onclick="createNew()">
      <span>+</span> Novo Retigráfico
    </button>

    <div class="section-title">Histórico de Arquivos</div>
    <div id="fileList" class="file-list">
      </div>
  </div>

  <script>
    // Gerenciador de Arquivos
    const INDEX_KEY = 'retigrafico_index_v1';
    
    function initSplash() {
      renderList();
      setTimeout(() => {
        document.getElementById('splash-screen').classList.add('hidden');
        document.body.style.overflow = 'auto';
      }, 2000); 
    }

    function getFiles() {
      try {
        return JSON.parse(localStorage.getItem(INDEX_KEY)) || [];
      } catch { return []; }
    }

    function renderList() {
      const list = getFiles();
      const container = document.getElementById('fileList');
      container.innerHTML = '';

      if (list.length === 0) {
        container.innerHTML = '<div class="empty-state">Nenhum retigráfico salvo.<br>Clique em "Novo" para começar.</div>';
        return;
      }

      // Ordena do mais recente para o mais antigo
      list.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(file => {
        const div = document.createElement('div');
        div.className = 'file-card';
        
        // Formatar data
        const dateObj = new Date(file.date);
        const dateStr = dateObj.toLocaleDateString('pt-BR');

        div.innerHTML = `
          <div class="file-header">
            <div>
              <div class="file-date">${dateStr}</div>
              <div class="file-name">${file.name}</div>
              <div class="file-kms">${file.desc || 'Trecho sem dados'}</div>
            </div>
          </div>
          <div class="file-actions">
            <button class="btn-card btn-open" onclick="openFile('${file.id}')">
              Abrir
            </button>
            <button class="btn-card btn-share" onclick="shareFile('${file.id}')">
              <svg class="icon-wa" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
              Enviar
            </button>
            <button class="btn-card btn-del" onclick="deleteFile('${file.id}')">✕</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function createNew() {
      // Limpa ID atual e vai para o app
      window.location.href = 'app.html?new=true';
    }

    function openFile(id) {
      window.location.href = `app.html?id=${id}`;
    }

    function deleteFile(id) {
      if(!confirm('Tem certeza que deseja apagar este retigráfico permanentemente?')) return;
      
      // Remove do índice
      let list = getFiles();
      list = list.filter(f => f.id !== id);
      localStorage.setItem(INDEX_KEY, JSON.stringify(list));
      
      // Remove os dados
      localStorage.removeItem(id);
      
      renderList();
    }

    // Compartilhamento Simulado (Redireciona para o app abrir e exportar)
    // Motivo: index.html não tem as libs de Excel carregadas para ser leve.
    function shareFile(id) {
       window.location.href = `app.html?id=${id}&action=share`;
    }

    window.addEventListener('load', initSplash);
  </script>
</body>
</html>
